{
  "metadata": {
    "source_dataset": "ccibt-hack25ww7-750.worldbank_staging_dataset",
    "target_dataset": "ccibt-hack25ww7-750.worldbank_target_dataset",
    "generated_at": "2024-01-01T00:00:00Z",
    "confidence": "high",
    "mode": "FIX"
  },
  "mappings": [
    {
      "source_table": "ccibt-hack25ww7-750.worldbank_staging_dataset.staging_countries",
      "target_table": "ccibt-hack25ww7-750.worldbank_target_dataset.dim_country",
      "match_confidence": 0.95,
      "column_mappings": [
        {
          "source_column": "country_code",
          "target_column": "country_key",
          "source_type": "STRING",
          "target_type": "STRING",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Direct mapping from source country_code to target country_key."
        },
        {
          "source_column": "country_name",
          "target_column": "country_name",
          "source_type": "STRING",
          "target_type": "STRING",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Direct mapping."
        },
        {
          "source_column": "iso3",
          "target_column": "iso3",
          "source_type": "STRING",
          "target_type": "STRING",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Direct mapping."
        },
        {
          "source_column": "region",
          "target_column": "region",
          "source_type": "STRING",
          "target_type": "STRING",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Direct mapping."
        },
        {
          "source_column": "income_group",
          "target_column": "income_group",
          "source_type": "STRING",
          "target_type": "STRING",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Direct mapping."
        }
      ],
      "unmapped_source_columns": [],
      "unmapped_target_columns": [],
      "mapping_errors": [],
      "validation_rules": [
        {
          "column": "country_key",
          "type": "NOT_NULL",
          "reason": "Target column is REQUIRED and serves as the primary key."
        }
      ],
      "primary_key": [
        "country_key"
      ],
      "uniqueness_constraints": [
        "country_key"
      ]
    },
    {
      "source_table": "ccibt-hack25ww7-750.worldbank_staging_dataset.staging_indicators_meta",
      "target_table": "ccibt-hack25ww7-750.worldbank_target_dataset.dim_indicator",
      "match_confidence": 0.95,
      "column_mappings": [
        {
          "source_column": "indicator_code",
          "target_column": "indicator_code",
          "source_type": "STRING",
          "target_type": "STRING",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Direct mapping."
        },
        {
          "source_column": "indicator_name",
          "target_column": "indicator_name",
          "source_type": "STRING",
          "target_type": "STRING",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Direct mapping."
        },
        {
          "source_column": "topic",
          "target_column": "topic",
          "source_type": "STRING",
          "target_type": "STRING",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Direct mapping."
        }
      ],
      "unmapped_source_columns": [],
      "unmapped_target_columns": [],
      "mapping_errors": [],
      "validation_rules": [
        {
          "column": "indicator_code",
          "type": "NOT_NULL",
          "reason": "Target column is REQUIRED and serves as the primary key."
        }
      ],
      "primary_key": [
        "indicator_code"
      ],
      "uniqueness_constraints": [
        "indicator_code"
      ]
    },
    {
      "source_table": "ccibt-hack25ww7-750.worldbank_staging_dataset.staging_gdp",
      "target_table": "ccibt-hack25ww7-750.worldbank_target_dataset.dim_time",
      "match_confidence": 0.8,
      "column_mappings": [
        {
          "source_column": "year",
          "target_column": "year",
          "source_type": "INTEGER",
          "target_type": "INTEGER",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Distinct years extracted from various staging tables."
        },
        {
          "source_column": "GENERATED",
          "target_column": "year_key",
          "source_type": "EXPRESSION",
          "target_type": "STRING",
          "type_conversion_needed": false,
          "transformation": "CAST(year AS STRING)",
          "notes": "Generated by casting the year to a string for a key."
        }
      ],
      "unmapped_source_columns": [],
      "unmapped_target_columns": [
        {
          "target_column": "year_key",
          "target_type": "STRING",
          "source_column": "GENERATED",
          "source_type": "EXPRESSION",
          "transformation": "CAST(year AS STRING)",
          "notes": "Generated by casting year to string for a key."
        }
      ],
      "mapping_errors": [
        {
          "error_type": "UNMAPPED_TARGET_COLUMN",
          "target_column": "year_key",
          "severity": "INFO",
          "message": "Target column 'year_key' is generated via expression due to no direct source."
        }
      ],
      "validation_rules": [
        {
          "column": "year",
          "type": "NOT_NULL",
          "reason": "Target column is REQUIRED and serves as the primary key."
        },
        {
          "column": "year",
          "type": "RANGE",
          "value": "[1900, 2100]",
          "reason": "Expected reasonable range for year values."
        }
      ],
      "primary_key": [
        "year"
      ],
      "uniqueness_constraints": [
        "year"
      ]
    },
    {
      "source_table": "ccibt-hack25ww7-750.worldbank_staging_dataset.staging_gdp",
      "target_table": "ccibt-hack25ww7-750.worldbank_target_dataset.agg_country_year",
      "match_confidence": 0.7,
      "column_mappings": [
        {
          "source_column": "country_code",
          "target_column": "country_key",
          "source_type": "STRING",
          "target_type": "STRING",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Mapped from `country_code` from staging tables (e.g., `staging_gdp`, `staging_countries`)."
        },
        {
          "source_column": "year",
          "target_column": "year",
          "source_type": "INTEGER",
          "target_type": "INTEGER",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Mapped from `year` from various staging tables (e.g., `staging_gdp`, `staging_population`)."
        },
        {
          "source_column": "value",
          "target_column": "gdp",
          "source_type": "INTEGER",
          "target_type": "NUMERIC",
          "type_conversion_needed": true,
          "transformation": "CAST(value AS NUMERIC)",
          "notes": "Mapped from `staging_gdp.value`. Type conversion from INTEGER to NUMERIC."
        },
        {
          "source_column": "value",
          "target_column": "population",
          "source_type": "INTEGER",
          "target_type": "INTEGER",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Mapped from `staging_population.value`."
        },
        {
          "source_column": "GENERATED",
          "target_column": "gdp_per_capita",
          "source_type": "EXPRESSION",
          "target_type": "NUMERIC",
          "type_conversion_needed": false,
          "transformation": "gdp / population",
          "notes": "Calculated as target GDP divided by target Population."
        },
        {
          "source_column": "value",
          "target_column": "life_expectancy",
          "source_type": "FLOAT",
          "target_type": "FLOAT",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Mapped from `staging_life_expectancy.value`."
        },
        {
          "source_column": "value",
          "target_column": "co2_emissions",
          "source_type": "INTEGER",
          "target_type": "INTEGER",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Mapped from `staging_co2_emissions.value`."
        },
        {
          "source_column": "value",
          "target_column": "primary_enrollment",
          "source_type": "FLOAT",
          "target_type": "FLOAT",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Mapped from `staging_primary_enrollment.value`."
        },
        {
          "source_column": "value",
          "target_column": "poverty_headcount",
          "source_type": "FLOAT",
          "target_type": "FLOAT",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Mapped from `staging_poverty_headcount.value`."
        }
      ],
      "unmapped_source_columns": [],
      "unmapped_target_columns": [
        {
          "target_column": "gdp_per_capita",
          "target_type": "NUMERIC",
          "source_column": "GENERATED",
          "source_type": "EXPRESSION",
          "transformation": "gdp / population",
          "notes": "Calculated as target GDP divided by target Population."
        }
      ],
      "mapping_errors": [
        {
          "error_type": "UNMAPPED_TARGET_COLUMN",
          "target_column": "gdp_per_capita",
          "severity": "INFO",
          "message": "Target column 'gdp_per_capita' is generated via expression (calculation) due to no direct source."
        }
      ],
      "validation_rules": [
        {
          "column": "gdp",
          "type": "NUMERIC_RANGE",
          "value": "[0, 1.0e15]",
          "reason": "Expected non-negative and realistic GDP values."
        },
        {
          "column": "population",
          "type": "NUMERIC_RANGE",
          "value": "[0, 1.0e10]",
          "reason": "Expected non-negative and realistic population values."
        },
        {
          "column": "gdp_per_capita",
          "type": "NUMERIC_RANGE",
          "value": "[0, 1.0e6]",
          "reason": "Expected non-negative and realistic GDP per capita values."
        },
        {
          "column": "life_expectancy",
          "type": "NUMERIC_RANGE",
          "value": "[0, 100]",
          "reason": "Expected non-negative and realistic life expectancy values."
        },
        {
          "column": "co2_emissions",
          "type": "NUMERIC_RANGE",
          "value": "[0, 1.0e12]",
          "reason": "Expected non-negative and realistic CO2 emission values."
        },
        {
          "column": "primary_enrollment",
          "type": "PERCENTAGE_RANGE",
          "value": "[0, 100]",
          "reason": "Expected primary enrollment to be a percentage."
        },
        {
          "column": "poverty_headcount",
          "type": "PERCENTAGE_RANGE",
          "value": "[0, 100]",
          "reason": "Expected poverty headcount to be a percentage."
        }
      ],
      "primary_key": [],
      "uniqueness_constraints": [
        "country_key",
        "year"
      ]
    },
    {
      "source_table": "ccibt-hack25ww7-750.worldbank_staging_dataset.staging_gdp",
      "target_table": "ccibt-hack25ww7-750.worldbank_target_dataset.fact_indicator_values",
      "match_confidence": 0.6,
      "column_mappings": [
        {
          "source_column": "country_code",
          "target_column": "country_key",
          "source_type": "STRING",
          "target_type": "STRING",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Mapped from `country_code` in various staging tables (e.g., `staging_gdp`, `staging_co2_emissions`)."
        },
        {
          "source_column": "year",
          "target_column": "year",
          "source_type": "INTEGER",
          "target_type": "INTEGER",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Mapped from `year` in various staging tables."
        },
        {
          "source_column": "indicator_code",
          "target_column": "indicator_code",
          "source_type": "STRING",
          "target_type": "STRING",
          "type_conversion_needed": false,
          "transformation": null,
          "notes": "Mapped from `indicator_code` in various staging tables."
        },
        {
          "source_column": "value",
          "target_column": "numeric_value",
          "source_type": "STRING",
          "target_type": "NUMERIC",
          "type_conversion_needed": true,
          "transformation": "CAST(value AS NUMERIC)",
          "notes": "Mapped from `value` in various staging tables (e.g., `staging_gdp.value`, `staging_life_expectancy.value`). Source 'value' can be INTEGER or FLOAT, requiring type conversion to NUMERIC."
        },
        {
          "source_column": "GENERATED",
          "target_column": "data_source",
          "source_type": "EXPRESSION",
          "target_type": "STRING",
          "type_conversion_needed": false,
          "transformation": "'SOURCE_TABLE_NAME'",
          "notes": "Generated to indicate the source staging table (e.g., 'staging_gdp', 'staging_co2_emissions') for the specific indicator value, which will be dynamically populated during ETL."
        },
        {
          "source_column": "GENERATED",
          "target_column": "loaded_at",
          "source_type": "EXPRESSION",
          "target_type": "TIMESTAMP",
          "type_conversion_needed": false,
          "transformation": "CURRENT_TIMESTAMP()",
          "notes": "Automatically generated timestamp upon data load into the fact table."
        }
      ],
      "unmapped_source_columns": [],
      "unmapped_target_columns": [
        {
          "target_column": "data_source",
          "target_type": "STRING",
          "source_column": "GENERATED",
          "source_type": "EXPRESSION",
          "transformation": "'SOURCE_TABLE_NAME'",
          "notes": "Generated to identify the originating staging table."
        },
        {
          "target_column": "loaded_at",
          "target_type": "TIMESTAMP",
          "source_column": "GENERATED",
          "source_type": "EXPRESSION",
          "transformation": "CURRENT_TIMESTAMP()",
          "notes": "Automatically generated timestamp upon data load."
        }
      ],
      "mapping_errors": [
        {
          "error_type": "UNMAPPED_TARGET_COLUMN",
          "target_column": "data_source",
          "severity": "INFO",
          "message": "Target column 'data_source' is generated via expression due to no direct source."
        },
        {
          "error_type": "UNMAPPED_TARGET_COLUMN",
          "target_column": "loaded_at",
          "severity": "INFO",
          "message": "Target column 'loaded_at' is generated via expression (CURRENT_TIMESTAMP()) due to no direct source."
        }
      ],
      "validation_rules": [
        {
          "column": "numeric_value",
          "type": "NUMERIC_RANGE",
          "value": "[-1.0e15, 1.0e15]",
          "reason": "General numeric range for indicator values."
        }
      ],
      "primary_key": [],
      "uniqueness_constraints": [
        "country_key",
        "year",
        "indicator_code",
        "data_source"
      ]
    }
  ]
}